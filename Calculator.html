<!DOCTYPE html>

<html lang="en">
    <head>
        <title>Calculator</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

        <style>
            body {background-color: lightgrey;}
            button {padding: 20px 0px 20px;}
            button:active {outline: none;}
            #calc {margin-top: 100px; font-size: larger;}
            #display {background-color: lightslategray; padding: 15px; text-align: right; color: white;}
            #keys {display: grid; grid-template-columns: auto auto auto auto; column-gap: 10px; row-gap: 10px; margin-top: 10px;}
            #equal {grid-column: -2; grid-row: 2 / span 4; background-color: mediumspringgreen;}
            .operator {background-color: lightsteelblue;}
            .highlight {background-color: rgba(176, 196, 222, 0.3);}
        </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="#"><b>Calculator</b></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
              <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="#">Action</a>
                  <a class="dropdown-item" href="#">Another action</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="#">Something else here</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
              </li>
            </ul>
            <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form>
          </div>
        </nav>

        <div class = "container" id="calc">
            <div id = "display">0</div>
            <div id = "keys">
                <button class="operator" data-action="add">+</button>
                <button class="operator" data-action="sub">-</button>
                <button class="operator" data-action="mult">&times;</button>
                <button class="operator" data-action="div">&divide;</button>
                <button>7</button>
                <button>8</button>
                <button>9</button>
                <button>4</button>
                <button>5</button>
                <button>6</button>
                <button>1</button>
                <button>2</button>
                <button>3</button>
                <button>0</button>
                <button data-action="dec">.</button>
                <button data-action="clear">AC</button>
                <button id="equal" data-action="equals">=</button>
            </div>
        </div>

    
    <script>
    const calculate = (s1, op, s2) => {
        let result = '';
        let n1 = parseFloat(s1);
        let n2 = parseFloat(s2);
        switch (op) {
            case 'add':
              result = n1 + n2;
              break;
            case 'sub':
              result = n1 - n2;
              break;
            case 'mult':
              result = n1 * n2;
              break;
            case 'div':
              result = n1 / n2;
              break;
        }
        return result;
    }
    
    const calculator = document.getElementById('calc');
    const keys = document.getElementById('keys');
    const disp = document.getElementById('display');
    keys.addEventListener('click', e => {
        if (e.target.matches('button')) {
            const key = e.target;
            const action = key.dataset.action;
            const keyContent = key.textContent;
            const dispNum = disp.textContent;
            const previousKeyType = calculator.dataset.previousKeyType;

            let val1 = calculator.dataset.val1;
            let val2 = dispNum;
            let operator = calculator.dataset.operator;
            const clearButton = calculator.querySelector('[data-action=clear]');

            Array.from(key.parentNode.children).forEach(k => k.classList.remove('highlight'));

            switch (action) {
                case 'add':
                case 'sub':
                case 'mult':
                case 'div':
                    clearButton.textContent = 'CE'
                    if (val1 && operator && (previousKeyType !== 'operator') && (previousKeyType !== 'equals')) {
                      const calcVal = calculate(val1, operator, val2);
                      disp.textContent = calcVal;
                      calculator.dataset.val1 = calcVal;
                    }
                    else {
                      calculator.dataset.val1 = dispNum;
                    }
                    key.classList.add('highlight');
                    calculator.dataset.previousKeyType = 'operator';
                    calculator.dataset.operator = action;
                    break;
                case 'dec':
                    clearButton.textContent = 'CE'
                    if (calculator.dataset.previousKeyType == 'operator' || previousKeyType == 'equals') {
                      disp.textContent = '0.';
                    }
                    else if (!dispNum.includes('.')) {
                      display.textContent = dispNum + '.';
                    }
                    calculator.dataset.previousKeyType = 'decimal';
                    break;
                case 'clear':
                    if (key.textContent === 'AC') {
                      calculator.dataset.val1 = '';
                      calculator.dataset.val2 = '';
                      calculator.dataset.operator = '';
                    }
                    else {
                      key.textContent = 'AC';
                    }
                    disp.textContent = 0;
                    calculator.dataset.previousKeyType = 'clear';
                    break;
                case 'equals':
                    clearButton.textContent = 'AC';
                    val1 = calculator.dataset.val1;
                    operator = calculator.dataset.operator;
                    if (val1) {
                      if (previousKeyType === 'equals') {
                        val1 = dispNum;
                        val2 = calculator.dataset.modValue;
                      }
                      disp.textContent = Math.round(calculate(val1, operator, val2) * 10000) / 10000;
                    }
                    calculator.dataset.modValue = val2;
                    calculator.dataset.previousKeyType = 'equals';
                    break;
                default:
                    clearButton.textContent = 'CE'
                    if (dispNum === '0' || previousKeyType === 'operator' || previousKeyType === 'equals') {
                        disp.textContent = keyContent;
                        
                    }
                    else {
                        disp.textContent = dispNum + keyContent;
                    }
                    calculator.dataset.previousKeyType = 'number';
            }
        }
    })
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    </body>
</html>